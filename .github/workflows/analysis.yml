# å·¥ä½œæµçš„åç§°
name: Crypto Turnover Spike Analysis

# å·¥ä½œæµçš„è§¦å‘æ¡ä»¶
on:
  # å…è®¸ä½ æ‰‹åŠ¨åœ¨Actionsé¡µé¢ç‚¹å‡»æŒ‰é’®æ¥è¿è¡Œæ­¤å·¥ä½œæµ
  workflow_dispatch:
  
  # å®šæ—¶è§¦å‘ï¼šä½¿ç”¨cronè¯­æ³•
  # ä¸‹é¢çš„ "0 2 * * *" è¡¨ç¤ºåœ¨æ¯å¤©çš„UTCæ—¶é—´å‡Œæ™¨2ç‚¹è¿è¡Œ
  # ä½ å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹ï¼Œä¾‹å¦‚ "0 8 * * *" è¡¨ç¤ºæ¯å¤©UTCæ—¶é—´æ—©ä¸Š8ç‚¹ï¼ˆåŒ—äº¬æ—¶é—´ä¸‹åˆ4ç‚¹ï¼‰
  schedule:
    - cron: '0 2 * * *'
  
  # å½“æœ‰ä»£ç æ¨é€åˆ°mainåˆ†æ”¯æ—¶ä¹Ÿè§¦å‘ï¼ˆæ–¹ä¾¿æµ‹è¯•ï¼‰
  push:
    branches:
      - main

# å®šä¹‰å·¥ä½œä»»åŠ¡
jobs:
  run-analysis:
    # æŒ‡å®šè¿è¡Œç¯å¢ƒï¼Œä½¿ç”¨æœ€æ–°çš„Ubuntuç³»ç»Ÿ
    runs-on: ubuntu-latest

    # å®šä¹‰ä»»åŠ¡çš„æ­¥éª¤
    steps:
      # ç¬¬ä¸€æ­¥ï¼šæ£€å‡ºä»£ç 
      # è¿™ä¸ªæ­¥éª¤ä¼šæŠŠä½ çš„ä»“åº“ä»£ç ä¸‹è½½åˆ°è™šæ‹Ÿæœºä¸­
      - name: Checkout repository
        uses: actions/checkout@v4

      # ç¬¬äºŒæ­¥ï¼šè®¾ç½®Pythonç¯å¢ƒ
      # æŒ‡å®šä½¿ç”¨Python 3.10ç‰ˆæœ¬
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # ç¬¬ä¸‰æ­¥ï¼šå®‰è£…ä¾èµ–
      # è¯»å– requirements.txt æ–‡ä»¶å¹¶å®‰è£…æ‰€æœ‰åº“
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # ç¬¬å››æ­¥ï¼šè¿è¡Œåˆ†æè„šæœ¬
      # æ‰§è¡Œä½ çš„Pythonè„šæœ¬ï¼Œè¿™ä¼šç”Ÿæˆ okx_turnover_spikes_analysis.csv æ–‡ä»¶
      - name: Run Python script for analysis
        run: python analyze_spikes.py

      # ç¬¬äº”æ­¥ï¼šæäº¤ç»“æœåˆ°ä»“åº“
      # è¿™æ˜¯ä¸€ä¸ªå…³é”®æ­¥éª¤ï¼Œå®ƒä¼šè‡ªåŠ¨å°†æ–°ç”Ÿæˆçš„CSVæ–‡ä»¶æäº¤å›ä½ çš„GitHubä»“åº“
      - name: Commit and push results
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # æäº¤ä¿¡æ¯ï¼Œå¯ä»¥è‡ªå®šä¹‰
          commit_message: "ğŸ“ˆ Analysis update for $(date +'%Y-%m-%d')"
          # è¦æäº¤çš„æ–‡ä»¶ï¼Œè¿™é‡Œæ˜¯æˆ‘ä»¬çš„CSVæŠ¥å‘Š
          file_pattern: okx_turnover_spikes_analysis.csv
          # æäº¤çš„ç”¨æˆ·å’Œé‚®ç®±
          commit_user_name: "GitHub Actions Bot"
          commit_user_email: "actions@github.com"
