name: ğŸ§¹ æ‰‹åŠ¨æ¸…ç†åƒåœ¾æ–‡ä»¶

# è¿™é‡Œçš„ workflow_dispatch æ„å‘³ç€è¿™æ˜¯ä¸€ä¸ª"æ‰‹åŠ¨å¼€å…³"
# ä½ å¿…é¡»åœ¨ Actions é¡µé¢ç‚¹å‡»æŒ‰é’®æ‰ä¼šè¿è¡Œï¼Œä¸ä¼šè‡ªåŠ¨è¿è¡Œ
on:
  workflow_dispatch:

permissions:
  contents: write  # å¿…é¡»ç»™å†™æƒé™ï¼Œå¦åˆ™æ— æ³•åˆ é™¤æ–‡ä»¶

jobs:
  cleanup-job:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ æ‹‰å–ä»£ç 
        uses: actions/checkout@v4

      - name: ğŸ—‘ï¸ æ‰§è¡Œåˆ é™¤å‘½ä»¤
        run: |
          echo "æ­£åœ¨æŸ¥æ‰¾å¹¶åˆ é™¤æ‰€æœ‰ Xray-linux-64.zip å¼€å¤´çš„æ–‡ä»¶..."
          
          # 1. ä½¿ç”¨ find å‘½ä»¤æŸ¥æ‰¾å¹¶åˆ é™¤å½“å‰ç›®å½•ä¸‹æ‰€æœ‰åŒ¹é…çš„æ–‡ä»¶
          # -name "Xray-linux-64.zip*" : åŒ¹é…æ‰€æœ‰å¸¦ç¼–å·çš„ zip
          # -delete : ç›´æ¥åˆ é™¤
          find . -maxdepth 1 -name "Xray-linux-64.zip*" -print -delete
          
          echo "âœ… åˆ é™¤æ“ä½œå®Œæˆ (æœ¬åœ°)"

      - name: ğŸ“¤ æäº¤å¹¶æ¨é€åˆ°ä»“åº“
        run: |
          git config --global user.name "CleanupBot"
          git config --global user.email "bot@github.com"
          
          # git add -u è¡¨ç¤ºåªå¤„ç†è¢«ä¿®æ”¹/åˆ é™¤çš„æ–‡ä»¶
          git add -u
          
          # æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶è¢«åˆ é™¤äº†ï¼Œå¦‚æœæœ‰åˆ™æäº¤
          if [[ -n $(git status -s) ]]; then
            git commit -m "ğŸ—‘ï¸ [æ‰‹åŠ¨æ¸…ç†] æ‰¹é‡åˆ é™¤å †ç§¯çš„ zip æ–‡ä»¶"
            git push
            echo "ğŸ‰ æˆåŠŸï¼åƒåœ¾æ–‡ä»¶å·²ä»ä»“åº“å½»åº•æ¸…é™¤ã€‚"
          else
            echo "ğŸ‘€ ä»“åº“å¾ˆå¹²å‡€ï¼Œæ²¡æœ‰å‘ç°éœ€è¦æäº¤çš„æ›´æ”¹ã€‚"
          fi
